@{
    ViewBag.Title = "ƒêƒÉng K√Ω Kh√≥a H·ªçc";
    Layout = null; // kh√¥ng d√πng layout
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>

    <!-- Link t·ªõi file CSS ri√™ng -->
    <link rel="stylesheet" href="~/css/Dangky.css" asp-append-version="true" />
</head>
<body>
    <div class="background-image">
            <img src="/img/DKH.png" alt="ƒêƒÉng K√Ω Kh√≥a H·ªçc" />
            <div class="register-container">
<<<<<<< HEAD
            <form id="registerForm" asp-action="DangKy" method="post" class="register-form">
=======
            <form asp-action="DangKy" method="post" class="register-form">
>>>>>>> d378627 (Initial commit)
                <label for="HoTen">H·ªç v√† t√™n</label>
                <input type="text" id="HoTen" name="HoTen" placeholder="Nh·∫≠p h·ªç t√™n" required />
                <label for="SDT">S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="tel" id="SDT" name="SDT" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required />
                <label for="Gmail">Email</label>
<<<<<<< HEAD
                <input type="email" id="Gmail" name="Gmail" 
                    placeholder="Nh·∫≠p email" 
                    value="@ViewBag.UserEmail" 
                    @(string.IsNullOrEmpty(ViewBag.UserEmail) ? "" : "readonly") />
=======
                <input type="email" id="Gmail" name="Gmail" placeholder="Nh·∫≠p email" required />
>>>>>>> d378627 (Initial commit)
                <label for="KhungGio">Khung gi·ªù c√≥ th·ªÉ li√™n h·ªá</label>
                <select id="KhungGio" name="KhungGio" required>
                    <option value="">-- Ch·ªçn khung gi·ªù --</option>
                    <option value="S√°ng">S√°ng (7:00 - 11:00)</option>
                    <option value="Tr∆∞a">Tr∆∞a (11:00 - 13:00)</option>
                    <option value="Chi·ªÅu">Chi·ªÅu (13:00 - 17:00)</option>
                    <option value="T·ªëi">T·ªëi (17:00 - 21:00)</option>
                </select>

                <div class="button-group">
                    <button type="button" class="btn-register" onclick="showQR()">
                    ƒêƒÇNG K√ù NGAY
                </button>

                    <a href="tel:0123456789" class="btn-contact">Li√™n h·ªá ngay</a>
                </div>
            </form>
        </div>
    </div>
    <div id="qrOverlay" class="qr-overlay" style="display:none;">
    <div class="qr-modal">
        <h3>Qu√©t m√£ QR ƒë·ªÉ thanh to√°n</h3>

        <img src="/img/QR.png" alt="QR thanh to√°n" class="qr-img" />

        <p>
            Th·ªùi gian c√≤n l·∫°i:
            <span id="countdown">10:00</span>
        </p>
        <div id="otpBox" style="display:none; margin-top:15px;">
            <input type="text" id="otpInput" placeholder="Nh·∫≠p m√£ OTP"
                style="padding:8px; width:94%; margin-bottom:10px;" />

            <button onclick="verifyOTP()" style="width:100%;">
                X√°c nh·∫≠n OTP
            </button>
        </div>
        <div class="qr-button-row">
            <button class="btn-close" onclick="closeQR()">ƒê√≥ng</button>
            <button class="btn-paid" onclick="sendOTP()">T√¥i ƒë√£ thanh to√°n</button>
        </div>

    </div>
</div>

</body>
<script>
    let timer;
    let totalSeconds = 600;
    

    function showQR() {
<<<<<<< HEAD
    const Gmail = document.getElementById('Gmail').value.trim();
    if (!Gmail) {
        alert("Vui l√≤ng nh·∫≠p email!");
        return;
    }

    // G·ªçi API ki·ªÉm tra email ƒë√£ ƒëƒÉng k√Ω ch∆∞a
    fetch('/Home/CheckEmail?email=' + encodeURIComponent(Gmail))
        .then(res => res.json())
        .then(data => {
            if (data.exists) {
                alert("Email n√†y ƒë√£ ƒëƒÉng k√Ω kh√≥a h·ªçc r·ªìi!");
                return;
            }
            // Email ch∆∞a ƒëƒÉng k√Ω ‚Üí hi·ªán QR
            document.getElementById("qrOverlay").style.display = "flex";
            totalSeconds = 600;
            clearInterval(timer);
            updateCountdown();
            timer = setInterval(() => {
                totalSeconds--;
                updateCountdown();
                if (totalSeconds <= 0) {
                    clearInterval(timer);
                    document.getElementById("countdown").innerText = "H·∫øt h·∫°n";
                    alert("M√£ QR ƒë√£ h·∫øt h·∫°n!");
                    closeQR();
                }
            }, 1000);
        });
}
=======
        document.getElementById("qrOverlay").style.display = "flex";
        totalSeconds = 600;

        clearInterval(timer);
        updateCountdown();

        timer = setInterval(() => {
            totalSeconds--;
            updateCountdown();

            if (totalSeconds <= 0) {
                clearInterval(timer);
                document.getElementById("countdown").innerText = "H·∫øt h·∫°n";
                alert("M√£ QR ƒë√£ h·∫øt h·∫°n!");
                closeQR();
            }
        }, 1000);
    }

    function closeQR() {
        clearInterval(timer);
        document.getElementById("qrOverlay").style.display = "none";
    }
>>>>>>> d378627 (Initial commit)

    function updateCountdown() {
        let minutes = Math.floor(totalSeconds / 60);
        let seconds = totalSeconds % 60;

        document.getElementById("countdown").innerText =
            minutes + ":" + seconds.toString().padStart(2, "0");
    }
    function sendOTP() {
        const sdt = document.getElementById('SDT').value;

        if (!sdt) {
            alert("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i!");
            return;
        }

        fetch('/Home/GuiOTP', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: 'sdt=' + encodeURIComponent(sdt)
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert("OTP ƒë√£ ƒë∆∞·ª£c g·ª≠i!");
                const otpBox = document.getElementById("otpBox");
                otpBox.style.display = "block";
                otpBox.scrollIntoView({ behavior: "smooth", block: "center" });
            }
        });
    }
<<<<<<< HEAD
function verifyOTP() {
    const otp = document.getElementById('otpInput').value;
    const HoTen = document.getElementById('HoTen').value;
    const SDT = document.getElementById('SDT').value;
    const Gmail = document.getElementById('Gmail').value;
    const KhungGio = document.getElementById('KhungGio').value;

    fetch('/Home/XacNhanOTP', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'otp=' + encodeURIComponent(otp)
    })
    .then(res => res.json())
    .then(data => {
        if (!data.success) {
            alert("OTP sai!");
            return;
        }

        // OTP ƒë√∫ng ‚Üí ƒëƒÉng k√Ω
        fetch('/Home/DangKyThanhCong', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ HoTen, SDT, Gmail, KhungGio })
        })
        .then(res => res.json())
        .then(result => {
            if (!result.success) {
                alert(result.message);
                return;
            }
            alert("ƒêƒÉng k√Ω kh√≥a h·ªçc th√†nh c√¥ng üéâ");
            window.location.href = result.redirect;
        });
    });
}
=======

    function verifyOTP() {
        const otp = document.getElementById('otpInput').value;

        fetch('/Home/XacNhanOTP', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: 'otp=' + otp
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert("ƒêƒÉng k√Ω th√†nh c√¥ng üéâ");
                closeQR();
            } else {
                alert("OTP sai!");
            }
        });
    }
>>>>>>> d378627 (Initial commit)

</script>


</html>
